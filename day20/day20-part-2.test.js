const { describe, it } = require('mocha');
const { expect } = require('chai');
const { Maze } = require('./day20-part-2');

describe('Day 20 - Part 2', () => {
  describe('Maze', () => {
    it('scans the maze on initialization', () => {
      const mazeMap = [
        '         A           ',
        '         A           ',
        '  #######.#########  ',
        '  #######.........#  ',
        '  #######.#######.#  ',
        '  #######.#######.#  ',
        '  #######.#######.#  ',
        '  #####  B    ###.#  ',
        'BC...##  C    ###.# ',
        '  ##.##       ###.#  ',
        '  ##...DE  F  ###.#  ',
        '  #####    G  ###.#  ',
        '  #########.#####.#  ',
        'DE..#######...###.# ',
        '  #.#########.###.#  ',
        'FG..#########.....# ',
        '  ###########.#####  ',
        '             Z       ',
        '             Z       '
      ];

      const maze = new Maze(mazeMap);

      expect(maze.portalMap).to.deep.equal({
        'AA-o': { row: 2, col: 9 },
        'BC-i': { row: 6, col: 9 },
        'BC-o': { row: 8, col: 2 },
        'DE-i': { row: 10, col: 6 },
        'DE-o': { row: 13, col: 2 },
        'FG-i': { row: 12, col: 11 },
        'FG-o': { row: 15, col: 2 },
        'ZZ-o': { row: 16, col: 13 }
      });
      expect(maze.mazeWidth).to.equal(21);
      expect(maze.positionToPortalMap).to.deep.equal({
        [2 * maze.mazeWidth + 9]: 'AA-o',
        [6 * maze.mazeWidth + 9]: 'BC-i',
        [8 * maze.mazeWidth + 2]: 'BC-o',
        [10 * maze.mazeWidth + 6]: 'DE-i',
        [13 * maze.mazeWidth + 2]: 'DE-o',
        [12 * maze.mazeWidth + 11]: 'FG-i',
        [15 * maze.mazeWidth + 2]: 'FG-o',
        [16 * maze.mazeWidth + 13]: 'ZZ-o'
      });
      expect(maze.destination).to.deep.equal({ row: 16, col: 13 });
    });

    describe('findMinPath', () => {
      it('returns the length of the minimum found path from AA to ZZ', function () {
        this.timeout(0);
        const mazeMapA = [
          '         A           ',
          '         A           ',
          '  #######.#########  ',
          '  #######.........#  ',
          '  #######.#######.#  ',
          '  #######.#######.#  ',
          '  #######.#######.#  ',
          '  #####  B    ###.#  ',
          'BC...##  C    ###.# ',
          '  ##.##       ###.#  ',
          '  ##...DE  F  ###.#  ',
          '  #####    G  ###.#  ',
          '  #########.#####.#  ',
          'DE..#######...###.# ',
          '  #.#########.###.#  ',
          'FG..#########.....# ',
          '  ###########.#####  ',
          '             Z       ',
          '             Z       '
        ];
        const mazeMapB = [
          '                   A               ',
          '                   A               ',
          '  #################.#############  ',
          '  #.#...#...................#.#.#  ',
          '  #.#.#.###.###.###.#########.#.#  ',
          '  #.#.#.......#...#.....#.#.#...#  ',
          '  #.#########.###.#####.#.#.###.#  ',
          '  #.............#.#.....#.......#  ',
          '  ###.###########.###.#####.#.#.#  ',
          '  #.....#        A   C    #.#.#.#  ',
          '  #######        S   P    #####.#  ',
          '  #.#...#                 #......VT',
          '  #.#.#.#                 #.#####  ',
          '  #...#.#               YN....#.#  ',
          '  #.###.#                 #####.#  ',
          'DI....#.#                 #.....#  ',
          '  #####.#                 #.###.#  ',
          'ZZ......#               QG....#..AS',
          '  ###.###                 #######  ',
          'JO..#.#.#                 #.....#  ',
          '  #.#.#.#                 ###.#.#  ',
          '  #...#..DI             BU....#..LF',
          '  #####.#                 #.#####  ',
          'YN......#               VT..#....QG',
          '  #.###.#                 #.###.#  ',
          '  #.#...#                 #.....#  ',
          '  ###.###    J L     J    #.#.###  ',
          '  #.....#    O F     P    #.#...#  ',
          '  #.###.#####.#.#####.#####.###.#  ',
          '  #...#.#.#...#.....#.....#.#...#  ',
          '  #.#####.###.###.#.#.#########.#  ',
          '  #...#.#.....#...#.#.#.#.....#.#  ',
          '  #.###.#####.###.###.#.#.#######  ',
          '  #.#.........#...#.............#  ',
          '  #########.###.###.#############  ',
          '           B   J   C               ',
          '           U   P   P               '
        ];
        const mazeMapC = [
          '             Z L X W       C                 ',
          '             Z P Q B       K                 ',
          '  ###########.#.#.#.#######.###############  ',
          '  #...#.......#.#.......#.#.......#.#.#...#  ',
          '  ###.#.#.#.#.#.#.#.###.#.#.#######.#.#.###  ',
          '  #.#...#.#.#...#.#.#...#...#...#.#.......#  ',
          '  #.###.#######.###.###.#.###.###.#.#######  ',
          '  #...#.......#.#...#...#.............#...#  ',
          '  #.#########.#######.#.#######.#######.###  ',
          '  #...#.#    F       R I       Z    #.#.#.#  ',
          '  #.###.#    D       E C       H    #.#.#.#  ',
          '  #.#...#                           #...#.#  ',
          '  #.###.#                           #.###.#  ',
          '  #.#....OA                       WB..#.#..ZH',
          '  #.###.#                           #.#.#.#  ',
          'CJ......#                           #.....#  ',
          '  #######                           #######  ',
          '  #.#....CK                         #......IC',
          '  #.###.#                           #.###.#  ',
          '  #.....#                           #...#.#  ',
          '  ###.###                           #.#.#.#  ',
          'XF....#.#                         RF..#.#.#  ',
          '  #####.#                           #######  ',
          '  #......CJ                       NM..#...#  ',
          '  ###.#.#                           #.###.#  ',
          'RE....#.#                           #......RF',
          '  ###.###        X   X       L      #.#.#.#  ',
          '  #.....#        F   Q       P      #.#.#.#  ',
          '  ###.###########.###.#######.#########.###  ',
          '  #.....#...#.....#.......#...#.....#.#...#  ',
          '  #####.#.###.#######.#######.###.###.#.#.#  ',
          '  #.......#.......#.#.#.#.#...#...#...#.#.#  ',
          '  #####.###.#####.#.#.#.#.###.###.#.###.###  ',
          '  #.......#.....#.#...#...............#...#  ',
          '  #############.#.#.###.###################  ',
          '               A O F   N                     ',
          '               A A D   M                     '
        ];
        const mazeA = new Maze(mazeMapA);
        const mazeB = new Maze(mazeMapB);
        const mazeC = new Maze(mazeMapC);

        expect(mazeA.findMinPath()).to.equal(26);
        expect(mazeB.findMinPath()).to.equal(Infinity);
        expect(mazeC.findMinPath()).to.equal(396);
      });
    });
  });
});
